<!--
  COMPOSANT : Validation des Documents
  DESCRIPTION : Interface de gestion et validation des documents en attente
  VERSION : 1.0.0
  AUTEUR : Logistik Team
-->

<div class="layout-wrapper">
  <!-- =========================================================================== -->
  <!-- SECTION : SIDEBAR PRINCIPALE (NAVIGATION) -->
  <!-- =========================================================================== -->
<aside class="layout-menu" id="sidebar">
  <div class="app-brand">
    <i class='bx bxs-truck' style="font-size: 2rem; color: white;"></i>
    <div>
      <span class="app-brand-text">Logistik</span>
      <div class="app-brand-subtitle">Gestion de flotte et locations</div>
    </div>
  </div>

  <ul class="menu-inner">
    <li class="menu-item" routerLinkActive="active">
      <a [routerLink]="['/dashboard']" class="menu-link">
        <i class="menu-icon bx bx-home-circle"></i>
        <div>Dashboard</div>
      </a>
    </li>

    <li class="menu-header">
      <span>RÉFÉRENTIELS</span>
    </li>

    <li class="menu-item" routerLinkActive="active open">
      <a href="javascript:void(0);" class="menu-link menu-toggle" (click)="toggleMenu($event)">
        <i class="menu-icon bx bx-group"></i>
        <div>Tiers</div>
      </a>
      <ul class="menu-sub">
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/tiers']" class="menu-link">
            <div>Tous les tiers</div>
          </a>
        </li>
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/tiers/documents-validation']" class="menu-link">
            <div>Documents à valider</div>
            <span class="badge badge-warning" *ngIf="dashboardStats.documentsPending > 0">
              {{ dashboardStats.documentsPending }}
            </span>
          </a>
        </li>
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/tiers/documents-management']" class="menu-link">
            <div>Gestion des documents</div>
            <span class="badge badge-info">
              <i class='bx bx-upload'></i>
              {{ dashboardStats.documentsPending > 0 ? dashboardStats.documentsPending : '' }}
            </span>
          </a>
        </li>
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/tiers/new']" class="menu-link">
            <div>Nouveau tier</div>
            <span class="badge badge-primary"><i class='bx bx-plus'></i></span>
          </a>
        </li>
      </ul>
    </li>

    <li class="menu-item" routerLinkActive="active open">
      <a href="javascript:void(0);" class="menu-link menu-toggle" (click)="toggleMenu($event)">
        <i class="menu-icon bx bx-car"></i>
        <div>Véhicules</div>
      </a>
      <ul class="menu-sub">
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/vehicules']" class="menu-link">
            <div>Tous les véhicules</div>
          </a>
        </li>
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/vehicules/ajouter']" class="menu-link">
            <div>Ajouter vehicule</div>
            <span class="badge badge-primary"><i class='bx bx-plus'></i></span>
          </a>
        </li>
      </ul>
    </li>

    <li class="menu-item" routerLinkActive="active open">
      <a href="javascript:void(0);" class="menu-link menu-toggle" (click)="toggleMenu($event)">
        <i class="menu-icon bx bx-folder"></i>
        <div>Documents</div>
      </a>
      <ul class="menu-sub">
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/documents']" class="menu-link">
            <div>Tous les documents</div>
          </a>
        </li>
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/documents/factures']" class="menu-link">
            <div>Factures fournisseurs</div>
          </a>
        </li>
      </ul>
    </li>

    <li class="menu-header">
      <span>CŒUR MÉTIER</span>
    </li>

    <li class="menu-item" routerLinkActive="active open">
      <a href="javascript:void(0);" class="menu-link menu-toggle" (click)="toggleMenu($event)">
        <i class="menu-icon bx bx-file"></i>
        <div>Contrats</div>
      </a>
      <ul class="menu-sub">
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/contrats']" class="menu-link">
            <div>Tous les contrats</div>
          </a>
        </li>
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/contrats/new']" class="menu-link">
            <div>Nouveau contrat</div>
            <span class="badge badge-primary"><i class='bx bx-plus'></i></span>
          </a>
        </li>
      </ul>
    </li>

    <li class="menu-item" routerLinkActive="active">
      <a [routerLink]="['/dashboard/calendrier']" class="menu-link">
        <i class="menu-icon bx bx-calendar"></i>
        <div>Calendrier & Échéances</div>
      </a>
    </li>

    <li class="menu-header">
      <span>FINANCE & COMPTABILITÉ</span>
    </li>

    <li class="menu-item" routerLinkActive="active open">
      <a href="javascript:void(0);" class="menu-link menu-toggle" (click)="toggleMenu($event)">
        <i class="menu-icon bx bx-credit-card"></i>
        <div>Comptes</div>
      </a>
      <ul class="menu-sub">
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/finance/comptes-bancaires']" class="menu-link">
            <div>Comptes bancaires</div>
          </a>
        </li>
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/finance/mobile-money']" class="menu-link">
            <div>Mobile Money</div>
          </a>
        </li>
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/finance/bilans']" class="menu-link">
            <div>Soldes & Bilans</div>
          </a>
        </li>
      </ul>
    </li>

    <li class="menu-item" routerLinkActive="active open">
      <a href="javascript:void(0);" class="menu-link menu-toggle" (click)="toggleMenu($event)">
        <i class="menu-icon bx bx-wallet"></i>
        <div>Paiements</div>
      </a>
      <ul class="menu-sub">
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/finance/paiements']" class="menu-link">
            <div>Tous les paiements</div>
          </a>
        </li>
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/finance/paiements/retard']" class="menu-link">
            <div>En retard</div><span class="badge badge-danger">5</span>
          </a>
        </li>
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/finance/paiements/attente']" class="menu-link">
            <div>En attente</div><span class="badge badge-warning">8</span>
          </a>
        </li>
      </ul>
    </li>

    <li class="menu-header">
      <span>ADMINISTRATION</span>
    </li>

    <li class="menu-item" routerLinkActive="active open">
      <a href="javascript:void(0);" class="menu-link menu-toggle" (click)="toggleMenu($event)">
        <i class="menu-icon bx bx-user"></i>
        <div>Utilisateurs</div>
      </a>
      <ul class="menu-sub">
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/admin/users-list']" class="menu-link">
            <div>Liste utilisateurs</div>
          </a>
        </li>
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/admin/user-detail']" class="menu-link">
            <div>Détail utilisateur</div>
          </a>
        </li>
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/admin/user-form']" class="menu-link">
            <div>Formulaire utilisateur</div>
            <span class="badge badge-primary"><i class='bx bx-plus'></i></span>
          </a>
        </li>
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/admin/user-roles']" class="menu-link">
            <div>Gestion rôles</div>
          </a>
        </li>
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/admin/user-permissions']" class="menu-link">
            <div>Permissions</div>
          </a>
        </li>
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/admin/user-profile']" class="menu-link">
            <div>Profil utilisateur</div>
          </a>
        </li>
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/admin/user-sessions']" class="menu-link">
            <div>Sessions</div>
          </a>
        </li>
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/admin/user-activity']" class="menu-link">
            <div>Activité</div>
          </a>
        </li>
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/admin/user-groups']" class="menu-link">
            <div>Groupes</div>
          </a>
        </li>
      </ul>
    </li>

    <li class="menu-item" routerLinkActive="active open">
      <a href="javascript:void(0);" class="menu-link menu-toggle" (click)="toggleMenu($event)">
        <i class="menu-icon bx bx-cog"></i>
        <div>Paramétrage</div>
      </a>
      <ul class="menu-sub">
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/settings/general']" class="menu-link">
            <div>Paramètres généraux</div>
          </a>
        </li>
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/settings/vehicules-types']" class="menu-link">
            <div>Types de véhicules</div>
          </a>
        </li>
      </ul>
    </li>

    <li class="menu-item" style="margin-top: 2rem;">
      <a class="menu-link" style="cursor: pointer;" (click)="logout()">
        <i class="menu-icon bx bx-log-out"></i>
        <div>Déconnexion</div>
      </a>
    </li>
  </ul>
</aside>

  <!-- =========================================================================== -->
  <!-- SECTION : CONTENU PRINCIPAL -->
  <!-- =========================================================================== -->
  <div class="layout-page" [style.marginLeft]="isSidebarCollapsed ? '0' : '280px'">
    <!-- =========================================================== -->
    <!-- SOUS-SECTION : NAVBAR (EN-TÊTE) -->
    <!-- =========================================================== -->
    <nav class="layout-navbar">
      <!-- Contrôles de navigation -->
      <div class="d-flex align-items-center">
        <button class="menu-toggle-btn" (click)="toggleSidebar()">
          <i class='bx bx-menu'></i>
        </button>
        <h3 class="mb-0 ms-3">Validation des Documents</h3>
      </div>

      <!-- Menu utilisateur -->
      <ul class="navbar-nav">
        <li class="nav-item dropdown" (click)="$event.stopPropagation(); showUserMenu = !showUserMenu">
          <div class="avatar dropdown-toggle">
            <!-- Avatar utilisateur dynamique -->
            <img *ngIf="userPhotoUrl && userPhotoUrl !== ''"
                 [src]="userPhotoUrl"
                 [alt]="userName"
                 (error)="userPhotoUrl = getDefaultAvatar()" />
            <div *ngIf="!userPhotoUrl || userPhotoUrl === ''" class="avatar-default">
              {{ getUserInitials() }}
            </div>
          </div>
          <div class="dropdown-menu" [class.show]="showUserMenu">
            <div style="padding: 1rem;">
              <div class="fw-bold">{{ userName }}</div>
              <div class="text-muted fs-sm">
                {{ currentUser?.roles?.[0] || 'Utilisateur Logistik' }}
              </div>
              <hr style="margin: 0.5rem 0;">
              <a [routerLink]="['/profile']" class="dropdown-item">
                <i class='bx bx-user me-2'></i> Mon profil
              </a>
              <a [routerLink]="['/settings']" class="dropdown-item">
                <i class='bx bx-cog me-2'></i> Paramètres
              </a>
              <hr style="margin: 0.5rem 0;">
              <a (click)="logout()" class="dropdown-item logout-item">
                <i class='bx bx-log-out me-2'></i> Déconnexion
              </a>
            </div>
          </div>
        </li>
      </ul>
    </nav>

    <!-- =========================================================== -->
    <!-- SOUS-SECTION : CONTENU DE LA PAGE -->
    <!-- =========================================================== -->
    <div class="content-wrapper">
      <!-- =========================================================== -->
      <!-- SECTION : EN-TÊTE ET DESCRIPTION -->
      <!-- =========================================================== -->
      <div class="dashboard-header mb-4">
        <div class="welcome-section">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h1 class="welcome-title">Validation des Documents</h1>
              <p class="welcome-subtitle mb-0">
                Gestion centralisée des documents en attente de validation. Validez, rejetez ou prévisualisez
                les pièces jointes.
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- =========================================================== -->
      <!-- SECTION : CONTENU PRINCIPAL (DEUX COLONNES) -->
      <!-- =========================================================== -->
      <div class="row">
        <!-- ========================================================= -->
        <!-- COLONNE GAUCHE : FILTRES ET ACTIONS -->
        <!-- ========================================================= -->
        <div class="col-12 col-lg-4 mb-4">
          <!-- Carte : Filtres avancés -->
          <div class="card filters-card">
            <div class="card-header">
              <h5 class="card-title mb-0">
                <i class='bx bx-filter-alt me-2'></i>Filtres avancés
              </h5>
              <button class="btn btn-sm btn-link text-muted" (click)="resetFilters()">
                <i class='bx bx-reset'></i> Réinitialiser
              </button>
            </div>
            <div class="card-body">
              <!-- Sous-section : Recherche rapide -->
              <div class="search-container mb-4">
                <form [formGroup]="searchForm">
                  <div class="input-group">
                    <span class="input-group-text">
                      <i class='bx bx-search'></i>
                    </span>
                    <input type="text"
                           class="form-control"
                           formControlName="searchTerm"
                           placeholder="Rechercher par nom, téléphone, numéro tier...">
                    <button class="btn btn-primary"
                            (click)="applySearch()"
                            [disabled]="isLoading">
                      <i class='bx bx-search'></i>
                    </button>
                  </div>
                </form>
              </div>

              <!-- Sous-section : Filtres détaillés -->
              <form [formGroup]="filterForm">
                <!-- Filtre : Type de document -->
                <div class="mb-3">
                  <label class="form-label">Type de document</label>
                  <select class="form-select" formControlName="documentType">
                    <option [ngValue]="null">Tous les types</option>
                    <option *ngFor="let type of documentTypes" [ngValue]="type">
                      <!-- {{ getDocumentTypeLabel(type) }} -->
                    </option>
                  </select>
                </div>

                <!-- Filtre : Statut du document -->
                <div class="mb-3">
                  <label class="form-label">Statut du document</label>
                  <select class="form-select" formControlName="documentStatus">
                    <option *ngFor="let status of documentStatuses" [ngValue]="status">
                      {{ getDocumentStatusLabel(status) }}
                    </option>
                  </select>
                </div>

                <!-- Filtre : Rôle du tier -->
                <div class="mb-3">
                  <label class="form-label">Rôle du tier</label>
                  <select class="form-select" formControlName="tierRole">
                    <option [ngValue]="null">Tous les rôles</option>
                    <option *ngFor="let role of tierRoles" [ngValue]="role">
                      {{ role }}
                    </option>
                  </select>
                </div>

                <!-- Filtre : Statut du tier -->
                <div class="mb-3">
                  <label class="form-label">Statut du tier</label>
                  <select class="form-select" formControlName="tierStatus">
                    <option [ngValue]="null">Tous les statuts</option>
                    <option *ngFor="let status of tierStatuses" [ngValue]="status">
                      {{ status }}
                    </option>
                  </select>
                </div>

                <!-- Option : Documents expirés uniquement -->
                <div class="form-check mb-3">
                  <input class="form-check-input"
                         type="checkbox"
                         formControlName="hasExpiredOnly"
                         id="expiredOnly">
                  <label class="form-check-label" for="expiredOnly">
                    Afficher uniquement les documents expirés
                  </label>
                </div>

                <!-- Bouton : Appliquer les filtres -->
                <div class="d-grid gap-2">
                  <button type="button"
                          class="btn btn-primary"
                          (click)="applySearch()"
                          [disabled]="isLoading">
                    <i class='bx bx-filter me-1'></i> Appliquer les filtres
                  </button>
                </div>
              </form>
            </div>
          </div>

          <!-- Carte : Actions rapides (commentée) -->
          <!--
          <div class="card quick-actions-card mt-4">
            <div class="card-header">
              <h5 class="card-title mb-0">
                <i class='bx bx-bolt me-2'></i>Actions rapides
              </h5>
            </div>
            <div class="card-body">
              <div class="d-grid gap-2">
                <button class="btn btn-outline-primary" (click)="goToTierPage(selectedTier?.id || '')"
                  [disabled]="!selectedTier">
                  <i class='bx bx-user me-1'></i> Voir le tier
                </button>
                <button class="btn btn-outline-success" (click)="validateAllDocumentsForTier(selectedTier!)"
                  [disabled]="!selectedTier || !hasDocumentsToValidate(selectedTier)">
                  <i class='bx bx-check-double me-1'></i> Tout valider
                </button>
                <button class="btn btn-outline-danger" (click)="exportDocuments('csv')" [disabled]="isExporting">
                  <i class='bx bx-download me-1'></i> Exporter CSV
                </button>
              </div>
            </div>
          </div>
          -->
        </div>

        <!-- ========================================================= -->
        <!-- COLONNE DROITE : LISTE DES DOCUMENTS -->
        <!-- ========================================================= -->
        <div class="col-12 col-lg-8 mb-4">
          <!-- Carte : Liste des documents -->
          <div class="card documents-list-card">
            <!-- En-tête de la carte -->
            <div class="card-header">
              <h5 class="card-title mb-0">
                <i class='bx bx-file me-2'></i>Documents à valider
                <span class="badge bg-primary ms-2">{{ documentsToValidate.length }}</span>
              </h5>
              <!-- Options de tri -->
              <div class="sort-options">
                <select class="form-select form-select-sm"
                        style="width: auto;"
                        (change)="sortDocuments($any($event.target).value)">
                  <option value="uploadedAt">Date d'upload</option>
                  <option value="expiryDate">Date d'expiration</option>
                  <option value="type">Type de document</option>
                  <option value="tier.firstName">Nom du tier</option>
                </select>
              </div>
            </div>

            <!-- Contenu de la carte -->
            <div class="card-body p-0">
              <!-- État : Chargement -->
              <div *ngIf="isLoading" class="text-center py-5">
                <div class="spinner-border text-primary mb-3" role="status">
                  <span class="visually-hidden">Chargement...</span>
                </div>
                <p class="text-muted">Chargement des documents...</p>
              </div>

              <!-- Liste des documents (si chargée) -->
              <div *ngIf="!isLoading">
                <!-- Tableau des documents -->
                <div class="table-responsive">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <!-- Colonne : Sélection -->
                        <th width="40">
                          <input type="checkbox" class="form-check-input">
                        </th>
                        <!-- Colonne : Tier -->
                        <th>Tier</th>
                        <!-- Colonne : Type -->
                        <th>Type</th>
                        <!-- Colonne : Statut -->
                        <th>Statut</th>
                        <!-- Colonne : Expiration -->
                        <th>Expiration</th>
                        <!-- Colonne : Actions -->
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      <!-- Ligne : Document (répétée pour chaque document) -->
                      <tr *ngFor="let doc of documentsToValidate"
                          [class.table-active]="selectedDocument?.id === doc.id"
                          (click)="selectDocumentForValidation(doc, doc.tier!)">
                        <!-- Cellule : Case à cocher -->
                        <td>
                          <input type="checkbox" class="form-check-input">
                        </td>

                        <!-- Cellule : Informations du tier -->
                        <td>
                          <div class="tier-info">
                            <strong>{{ doc.tier?.firstName }} {{ doc.tier?.lastName }}</strong>
                            <div class="text-muted fs-sm">{{ doc.tier?.tierNumber }}</div>
                          </div>
                        </td>

                        <!-- Cellule : Type de document -->
                        <td>
                          <span class="document-type-badge" [class]="'type-' + doc.type">
                            <i class='bx bx-file'></i>
                            {{ getDocumentTypeLabel(doc.type) }}
                          </span>
                        </td>

                        <!-- Cellule : Statut du document -->
                        <td>
                          <span class="status-badge" [class]="getDocumentStatusClass(doc.status)">
                            <i class='bx bx-circle fs-xs me-1'></i>
                            {{ getDocumentStatusLabel(doc.status) }}
                          </span>
                        </td>

                        <!-- Cellule : Date d'expiration -->
                        <td>
                          <div [class]="getExpirationClass(doc)">
                            <span *ngIf="doc.expiryDate">
                              {{ doc.expiryDate | date:'dd/MM/yyyy' }}
                              <span class="badge bg-warning ms-1" *ngIf="getDaysUntilExpiry(doc) !== null">
                                {{ getDaysUntilExpiry(doc) }}j
                              </span>
                            </span>
                            <span *ngIf="!doc.expiryDate" class="text-muted">-</span>
                          </div>
                        </td>

                        <!-- Cellule : Actions -->
                        <td>
                          <div class="btn-group btn-group-sm">
                            <!-- Bouton : Prévisualiser -->
                            <button class="btn btn-outline-primary"
                                    (click)="previewDocument(doc); $event.stopPropagation()">
                              <i class='bx bx-show'></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <!-- ================================================= -->
                <!-- SOUS-SECTION : PAGINATION -->
                <!-- ================================================= -->
                <div *ngIf="documentsToValidate.length > 0" class="card-footer">
                  <div class="d-flex justify-content-between align-items-center">
                    <!-- Informations de pagination -->
                    <div class="text-muted">
                      Affichage de {{ documentsToValidate.length }} documents
                    </div>

                    <!-- Contrôles de pagination -->
                    <nav aria-label="Pagination">
                      <ul class="pagination pagination-sm mb-0">
                        <!-- Bouton : Page précédente -->
                        <li class="page-item" [class.disabled]="currentPage === 1">
                          <a class="page-link" (click)="goToPage(currentPage - 1)">
                            <i class='bx bx-chevron-left'></i>
                          </a>
                        </li>

                        <!-- Numéros de page -->
                        <li *ngFor="let page of getPageNumbers()"
                            class="page-item"
                            [class.active]="page === currentPage">
                          <a class="page-link" (click)="goToPage(page)">{{ page }}</a>
                        </li>

                        <!-- Bouton : Page suivante -->
                        <li class="page-item" [class.disabled]="currentPage === totalPages">
                          <a class="page-link" (click)="goToPage(currentPage + 1)">
                            <i class='bx bx-chevron-right'></i>
                          </a>
                        </li>
                      </ul>
                    </nav>
                  </div>
                </div>

                <!-- État : Aucun document -->
                <div *ngIf="documentsToValidate.length === 0 && !isLoading" class="text-center py-5">
                  <i class='bx bx-file-find display-1 text-muted mb-3'></i>
                  <h5 class="text-muted">Aucun document trouvé</h5>
                  <p class="text-muted mb-0">Aucun document ne correspond aux critères de recherche.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- =========================================================== -->
      <!-- SECTION : MODAL DE PRÉVISUALISATION (OVERLAY) -->
      <!-- =========================================================== -->
      <!-- Overlay de fond -->
      <div class="modal-backdrop" *ngIf="isPreviewModalOpen" (click)="closePreview()"></div>

      <!-- Modal de prévisualisation -->
      <div class="modal-preview" *ngIf="isPreviewModalOpen">
        <!-- En-tête du modal -->
        <div class="modal-preview-header">
          <h5>Prévisualisation du document</h5>
          <button class="btn-close" (click)="closePreview()">
            <i class='bx bx-x'></i>
          </button>
        </div>

        <!-- Corps du modal -->
        <div class="modal-preview-body">
          <div class="preview-container" *ngIf="documentPreviewUrl">
            <!-- Iframe pour l'affichage du document -->
            <iframe [src]="documentPreviewUrl" class="preview-iframe" *ngIf="documentPreviewUrl"></iframe>

            <!-- Message si prévisualisation indisponible -->
            <div class="preview-unavailable" *ngIf="!documentPreviewUrl">
              <i class='bx bx-file display-1 text-muted mb-3'></i>
              <p class="text-muted">Prévisualisation non disponible</p>
            </div>
          </div>
        </div>

        <!-- Pied du modal -->
        <div class="modal-preview-footer">
          <button class="btn btn-secondary" (click)="closePreview()">
            <i class='bx bx-x me-1'></i> Fermer
          </button>
        </div>
      </div>

      <!-- =========================================================== -->
      <!-- SECTION : PANEL LATERAL DE VALIDATION -->
      <!-- =========================================================== -->
      <div class="validation-sidebar" [class.active]="selectedDocument">
        <!-- En-tête du panel -->
        <div class="validation-header">
          <h5>Validation du document</h5>
          <button class="btn-close" (click)="selectedDocument = null; selectedTier = null">
            <i class='bx bx-x'></i>
          </button>
        </div>

        <!-- Corps du panel (si document sélectionné) -->
        <div class="validation-body" *ngIf="selectedDocument && selectedTier">
          <!-- Informations du document -->
          <div class="document-info-card mb-4">
            <div class="document-icon">
              <i class='bx bx-file'></i>
            </div>
            <div>
              <h6>{{ getDocumentTypeLabel(selectedDocument.type) }}</h6>
              <p class="text-muted mb-1">{{ selectedDocument.fileName }}</p>
              <small class="text-muted">{{ formatFileSize(selectedDocument.fileSize) }}</small>
            </div>
          </div>

          <!-- Informations du tier -->
          <div class="tier-info-card mb-4">
            <div class="d-flex align-items-center">
              <!-- Avatar du tier -->
              <div class="tier-avatar me-3">
                {{ selectedTier.firstName.charAt(0) }}{{ selectedTier.lastName.charAt(0) }}
              </div>
              <!-- Détails du tier -->
              <div>
                <h6>{{ selectedTier.firstName }} {{ selectedTier.lastName }}</h6>
                <p class="text-muted mb-0">{{ selectedTier.phone }}</p>
              </div>
            </div>
          </div>

          <!-- ================================================= -->
          <!-- SOUS-SECTION : FORMULAIRE DE VALIDATION -->
          <!-- ================================================= -->
          <form [formGroup]="validationForm" class="mb-4">
            <!-- Champ : Commentaires -->
            <div class="mb-3">
              <label class="form-label">Commentaires (optionnel)</label>
              <textarea class="form-control"
                        formControlName="comments"
                        rows="3"
                        placeholder="Ajoutez un commentaire pour la validation..."></textarea>
            </div>

            <!-- Bouton : Valider -->
            <button type="button"
                    class="btn btn-success w-100 mb-2"
                    (click)="validateDocument()"
                    [disabled]="selectedDocument.status !== 1">
              <i class='bx bx-check me-1'></i> Valider le document
            </button>
          </form>

          <!-- ================================================= -->
          <!-- SOUS-SECTION : FORMULAIRE DE REJET -->
          <!-- ================================================= -->
          <form [formGroup]="rejectionForm" class="rejection-form">
            <h6 class="text-danger mb-3">
              <i class='bx bx-error-circle me-1'></i>Rejeter le document
            </h6>

            <!-- Champ : Motif du rejet -->
            <div class="mb-3">
              <label class="form-label">Motif du rejet *</label>
              <input type="text"
                     class="form-control"
                     formControlName="reason"
                     placeholder="Ex: Document illisible, informations manquantes...">
            </div>

            <!-- Champ : Commentaires -->
            <div class="mb-3">
              <label class="form-label">Commentaires</label>
              <textarea class="form-control"
                        formControlName="comments"
                        rows="2"
                        placeholder="Détails supplémentaires..."></textarea>
            </div>

            <!-- Bouton : Rejeter -->
            <button type="button"
                    class="btn btn-outline-danger w-100"
                    (click)="rejectDocument()"
                    [disabled]="!rejectionForm.valid || selectedDocument.status !== 1">
              <i class='bx bx-x me-1'></i> Rejeter le document
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- =========================================================== -->
    <!-- SECTION : FOOTER -->
    <!-- =========================================================== -->
    <div class="content-footer">
      <div class="d-flex justify-content-between align-items-center">
        <!-- Copyright -->
        <div>
          © 2026 Logistik. Tous droits réservés.
        </div>

        <!-- État de connexion -->
        <div class="text-muted">
          <span class="badge bg-light text-dark">
            <i class='bx bx-time me-1'></i> {{ currentUser ? 'Connecté' : 'Déconnecté' }}
          </span>
        </div>
      </div>
    </div>
  </div>

        <!-- COMPOSANT DE NOTIFICATION -->
      <app-notification-component></app-notification-component>

  <!-- Dialogue de confirmation (commenté) -->
  <!--
  <app-confirm-dialog [title]="confirmDialogConfig.title" [message]="confirmDialogConfig.message"
    [details]="confirmDialogConfig.details" [confirmText]="confirmDialogConfig.confirmText"
    [cancelText]="confirmDialogConfig.cancelText" [visible]="showConfirmDialog" (confirm)="onDialogConfirm()"
    (cancel)="onDialogCancel()">
  </app-confirm-dialog>
  -->
</div>
