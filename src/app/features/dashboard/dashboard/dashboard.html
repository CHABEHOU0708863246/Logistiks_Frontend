<div class="layout-wrapper">
  <div class="layout-container">
    <!-- SIDEBAR COMPL√àTE -->
    <!-- SIDEBAR COMPL√àTE -->
    <aside class="layout-menu" id="sidebar">
      <div class="app-brand">
        <i class='bx bxs-truck' style="font-size: 2rem; color: white;"></i>
        <div>
          <span class="app-brand-text">Logistik</span>
          <div class="app-brand-subtitle">Gestion de flotte et locations</div>
        </div>
      </div>

      <ul class="menu-inner">
        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard']" class="menu-link">
            <i class="menu-icon bx bx-home-circle"></i>
            <div>Dashboard</div>
          </a>
        </li>

        <li class="menu-header">
          <span>R√âF√âRENTIELS</span>
        </li>

        <li class="menu-item" routerLinkActive="active open">
          <a href="javascript:void(0);" class="menu-link menu-toggle" (click)="toggleMenu($event)">
            <i class="menu-icon bx bx-group"></i>
            <div>Tiers</div>
          </a>
          <ul class="menu-sub">
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/tiers']" class="menu-link">
                <div>Tous les tiers</div>
              </a>
            </li>
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/tiers/documents-validation']" class="menu-link">
                <div>Documents √† valider</div>
              </a>
            </li>
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/tiers/documents-management']" class="menu-link">
                <div>Gestion des documents</div>
              </a>
            </li>
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/tiers/new']" class="menu-link">
                <div>Nouveau tier</div>
                <span class="badge badge-primary"><i class='bx bx-plus'></i></span>
              </a>
            </li>
          </ul>
        </li>

        <li class="menu-item" routerLinkActive="active open">
          <a href="javascript:void(0);" class="menu-link menu-toggle" (click)="toggleMenu($event)">
            <i class="menu-icon bx bx-car"></i>
            <div>V√©hicules</div>
          </a>
          <ul class="menu-sub">
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/vehicules']" class="menu-link">
                <div>Tous les v√©hicules</div>
              </a>
            </li>
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/vehicules/ajouter']" class="menu-link">
                <div>Ajouter vehicule</div>
                <span class="badge badge-primary"><i class='bx bx-plus'></i></span>
              </a>
            </li>
          </ul>
        </li>

        <li class="menu-item" routerLinkActive="active open">
          <a href="javascript:void(0);" class="menu-link menu-toggle" (click)="toggleMenu($event)">
            <i class="menu-icon bx bx-folder"></i>
            <div>Documents</div>
          </a>
          <ul class="menu-sub">
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/documents']" class="menu-link">
                <div>Tous les documents</div>
              </a>
            </li>
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/documents/factures']" class="menu-link">
                <div>Factures fournisseurs</div>
              </a>
            </li>
          </ul>
        </li>

        <li class="menu-header">
          <span>C≈íUR M√âTIER</span>
        </li>

        <li class="menu-item" routerLinkActive="active open">
          <a href="javascript:void(0);" class="menu-link menu-toggle" (click)="toggleMenu($event)">
            <i class="menu-icon bx bx-file"></i>
            <div>Contrats</div>
          </a>
          <ul class="menu-sub">
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/contrats']" class="menu-link">
                <div>Tous les contrats</div>
              </a>
            </li>
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/contrats/new']" class="menu-link">
                <div>Nouveau contrat</div>
                <span class="badge badge-primary"><i class='bx bx-plus'></i></span>
              </a>
            </li>
          </ul>
        </li>

        <li class="menu-item" routerLinkActive="active">
          <a [routerLink]="['/dashboard/calendrier']" class="menu-link">
            <i class="menu-icon bx bx-calendar"></i>
            <div>Calendrier & √âch√©ances</div>
          </a>
        </li>

        <li class="menu-header">
          <span>FINANCE & COMPTABILIT√â</span>
        </li>

        <li class="menu-item" routerLinkActive="active open">
          <a href="javascript:void(0);" class="menu-link menu-toggle" (click)="toggleMenu($event)">
            <i class="menu-icon bx bx-credit-card"></i>
            <div>Comptes</div>
          </a>
          <ul class="menu-sub">
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/finance/comptes-bancaires']" class="menu-link">
                <div>Comptes bancaires</div>
              </a>
            </li>
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/finance/mobile-money']" class="menu-link">
                <div>Mobile Money</div>
              </a>
            </li>
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/finance/bilans']" class="menu-link">
                <div>Soldes & Bilans</div>
              </a>
            </li>
          </ul>
        </li>

        <li class="menu-item" routerLinkActive="active open">
          <a href="javascript:void(0);" class="menu-link menu-toggle" (click)="toggleMenu($event)">
            <i class="menu-icon bx bx-wallet"></i>
            <div>Paiements</div>
          </a>
          <ul class="menu-sub">
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/finance/paiements']" class="menu-link">
                <div>Tous les paiements</div>
              </a>
            </li>
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/finance/paiements/retard']" class="menu-link">
                <div>En retard</div><span class="badge badge-danger">5</span>
              </a>
            </li>
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/finance/paiements/attente']" class="menu-link">
                <div>En attente</div><span class="badge badge-warning">8</span>
              </a>
            </li>
          </ul>
        </li>

        <li class="menu-header">
          <span>ADMINISTRATION</span>
        </li>

        <li class="menu-item" routerLinkActive="active open">
          <a href="javascript:void(0);" class="menu-link menu-toggle" (click)="toggleMenu($event)">
            <i class="menu-icon bx bx-user"></i>
            <div>Utilisateurs</div>
          </a>
          <ul class="menu-sub">
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/admin/users-list']" class="menu-link">
                <div>Liste utilisateurs</div>
              </a>
            </li>
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/admin/user-detail']" class="menu-link">
                <div>D√©tail utilisateur</div>
              </a>
            </li>
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/admin/user-form']" class="menu-link">
                <div>Formulaire utilisateur</div>
                <span class="badge badge-primary"><i class='bx bx-plus'></i></span>
              </a>
            </li>
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/admin/user-roles']" class="menu-link">
                <div>Gestion r√¥les</div>
              </a>
            </li>
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/admin/user-permissions']" class="menu-link">
                <div>Permissions</div>
              </a>
            </li>
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/admin/user-profile']" class="menu-link">
                <div>Profil utilisateur</div>
              </a>
            </li>
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/admin/user-sessions']" class="menu-link">
                <div>Sessions</div>
              </a>
            </li>
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/admin/user-activity']" class="menu-link">
                <div>Activit√©</div>
              </a>
            </li>
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/admin/user-groups']" class="menu-link">
                <div>Groupes</div>
              </a>
            </li>
          </ul>
        </li>

        <li class="menu-item" routerLinkActive="active open">
          <a href="javascript:void(0);" class="menu-link menu-toggle" (click)="toggleMenu($event)">
            <i class="menu-icon bx bx-cog"></i>
            <div>Param√©trage</div>
          </a>
          <ul class="menu-sub">
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/settings/general']" class="menu-link">
                <div>Param√®tres g√©n√©raux</div>
              </a>
            </li>
            <li class="menu-item" routerLinkActive="active">
              <a [routerLink]="['/dashboard/settings/vehicules-types']" class="menu-link">
                <div>Types de v√©hicules</div>
              </a>
            </li>
          </ul>
        </li>

        <li class="menu-item" style="margin-top: 2rem;">
          <a class="menu-link" style="cursor: pointer;" (click)="logout()">
            <i class="menu-icon bx bx-log-out"></i>
            <div>D√©connexion</div>
          </a>
        </li>
      </ul>
    </aside>

    <!-- MAIN CONTENT -->
    <div class="layout-page">
      <!-- NAVBAR -->
      <nav class="layout-navbar">
        <div class="d-flex align-items-center">
          <button class="menu-toggle-btn" (click)="toggleSidebar()">
            <i class='bx bx-menu'></i>
          </button>
        </div>

        <ul class="navbar-nav">

          <!-- User dropdown avec photo dynamique -->
          <li class="nav-item dropdown" (click)="toggleUserMenu()">
            <div class="avatar dropdown-toggle">
              <!-- Photo dynamique de l'utilisateur -->
              <img *ngIf="userPhotoUrl && userPhotoUrl !== ''" [src]="userPhotoUrl" [alt]="userName"
                (error)="userPhotoUrl = getDefaultAvatar()" />

              <!-- Avatar par d√©faut si pas de photo -->
              <div *ngIf="!userPhotoUrl || userPhotoUrl === ''" class="avatar-default">
                {{ getUserInitials() }}
              </div>
            </div>

            <!-- Menu dropdown -->
            <div class="dropdown-menu" [class.show]="showUserMenu" id="userMenu">
              <div style="padding: 1rem;">
                <div class="fw-bold">{{ userName }}</div>
                <div class="text-muted fs-sm">
                  {{ currentUser?.roles?.[0] || 'Utilisateur Logistik' }}
                </div>
                <hr style="margin: 0.5rem 0;">
                <a [routerLink]="['/profile']" class="dropdown-item">
                  <i class='bx bx-user mr-2'></i> Mon profil
                </a>
                <a [routerLink]="['/settings']" class="dropdown-item">
                  <i class='bx bx-cog mr-2'></i> Param√®tres
                </a>
                <hr style="margin: 0.5rem 0;">
                <a (click)="logout()" class="dropdown-item logout-item">
                  <i class='bx bx-log-out mr-2'></i> D√©connexion
                </a>
              </div>
            </div>
          </li>
        </ul>
      </nav>

      <!-- DASHBOARD PRINCIPAL -->
      <div class="content-wrapper" id="main-content">
        <!-- SECTION BIENVENUE DYNAMIQUE -->
        <div class="welcome-section">
          <!-- Nom d'utilisateur dynamique -->
          <h1 class="welcome-title">Bonjour, {{ userName }} üëã</h1>

          <!-- Message de bienvenue dynamique -->
          <!-- Message de bienvenue dynamique -->
          <p class="welcome-subtitle">
            Bienvenue sur votre tableau de bord Logistiks.

            <!-- Section Documents -->
            <ng-container *ngIf="dashboardStats.documentsPending > 0; else noPendingDocs">
              <strong>
                {{ dashboardStats.documentsPending }} document{{ dashboardStats.documentsPending > 1 ? 's' : '' }}
              </strong>
              enregistrez dans notre base de donn√©e,
            </ng-container>
            <ng-template #noPendingDocs>
              <span *ngIf="dashboardStats.documentsPending === 0">
                tous les documents sont valid√©s,
              </span>
            </ng-template>

            <!-- Section Paiements -->
            <ng-container *ngIf="dashboardStats.paymentsOverdue > 0; else noOverduePayments">
              <strong>
                {{ dashboardStats.paymentsOverdue }} paiement{{ dashboardStats.paymentsOverdue > 1 ? 's' : '' }}
              </strong>
              sont en retard,
            </ng-container>
            <ng-template #noOverduePayments>
              <span *ngIf="dashboardStats.paymentsOverdue === 0">
                aucun paiement n'est en retard,
              </span>
            </ng-template>

            <!-- Section V√©hicules -->
            <ng-container *ngIf="dashboardStats.vehiclesNeedingAttention > 0; else noVehicleAttention">
              <strong>
                {{ dashboardStats.vehiclesNeedingAttention }} v√©hicule{{ dashboardStats.vehiclesNeedingAttention > 1 ?
                's' : '' }}
              </strong>
              n√©cessitent votre attention.
            </ng-container>
            <ng-template #noVehicleAttention>
              <span *ngIf="dashboardStats.vehiclesNeedingAttention === 0">
                tous les v√©hicules sont op√©rationnels.
              </span>
            </ng-template>
          </p>

          <!-- Quick actions -->
          <div class="quick-actions">
            <a [routerLink]="['/contrats/nouveau']" class="quick-action-btn">
              <i class='bx bx-plus'></i>
              Nouveau Contrat
            </a>
            <a [routerLink]="['/paiements/nouveau']" class="quick-action-btn">
              <i class='bx bx-dollar-circle'></i>
              Enregistrer Paiement
            </a>
            <a [routerLink]="['/dashboard/tiers/documents-validation']" class="quick-action-btn">
              <i class='bx bx-check-circle'></i>
              Valider Documents
            </a>
            <a [routerLink]="['/paiements/retards']" class="quick-action-btn">
              <i class='bx bx-time'></i>
              Voir Retards
            </a>
          </div>
        </div>

        <!-- KPI PRINCIPAUX - Premier card TIERS ACTIFS dynamique -->
        <div class="row">
          <!-- CARD 1: TIERS ACTIFS (Dynamique) -->
          <div class="col-3">
            <div class="card">
              <div class="card-body">
                <div class="stat-card">
                  <div class="stat-icon primary">
                    <i class='bx bx-group'></i>
                  </div>
                  <div class="stat-content">
                    <!-- Nombre dynamique de tiers actifs -->
                    <h3>{{ getFormattedNumber(dashboardStats.activeTiers) }}</h3>
                    <p>Tiers Actifs</p>
                    <!-- Calcul dynamique du pourcentage -->
                    <div class="stat-trend" [class.trend-up]="getTiersTrend() >= 0"
                      [class.trend-down]="getTiersTrend() < 0">
                      <i class='bx' [class.bx-up-arrow-alt]="getTiersTrend() >= 0"
                        [class.bx-down-arrow-alt]="getTiersTrend() < 0">
                      </i>
                      <!-- Pourcentage dynamique -->
                      {{ getTiersTrend() >= 0 ? '+' : '' }}{{ getTiersTrend() }}% ce mois
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- CARD 2: V√âHICULES OP√âRATIONNELS (Dynamique) -->
          <div class="col-3">
            <div class="card">
              <div class="card-body">
                <div class="stat-card">
                  <div class="stat-icon success">
                    <i class='bx bx-car'></i>
                  </div>
                  <div class="stat-content">
                    <h3>{{ getFormattedNumber(dashboardStats.vehiclesNeedingAttention) }}</h3>
                    <p>V√©hicules Op√©rationnels</p>
                    <div class="stat-trend" [class.trend-up]="getVehiclesTrend() >= 0"
                      [class.trend-down]="getVehiclesTrend() < 0">
                      <i class='bx' [class.bx-up-arrow-alt]="getVehiclesTrend() >= 0"
                        [class.bx-down-arrow-alt]="getVehiclesTrend() < 0">
                      </i>
                      {{ getVehiclesTrend() >= 0 ? '+' : '' }}{{ getVehiclesTrend() }}% ce mois
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- CARD 3: CONTRATS ACTIFS (Dynamique) -->
          <div class="col-3">
            <div class="card">
              <div class="card-body">
                <div class="stat-card">
                  <div class="stat-icon warning">
                    <i class='bx bx-file'></i>
                  </div>
                  <div class="stat-content">
                    <h3>{{ getFormattedNumber(dashboardStats.activeContracts) }}</h3>
                    <p>Contrats Actifs</p>
                    <div class="stat-trend" [class.trend-up]="getContractsTrend() >= 0"
                      [class.trend-down]="getContractsTrend() < 0">
                      <i class='bx' [class.bx-up-arrow-alt]="getContractsTrend() >= 0"
                        [class.bx-down-arrow-alt]="getContractsTrend() < 0">
                      </i>
                      {{ getContractsTrend() >= 0 ? '+' : '' }}{{ getContractsTrend() }}% ce mois
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- CARD 4: TAUX DE RECOUVREMENT (Dynamique) -->
          <div class="col-3">
            <div class="card">
              <div class="card-body">
                <div class="stat-card">
                  <div class="stat-icon danger">
                    <i class='bx bx-wallet'></i>
                  </div>
                  <div class="stat-content">
                    <h3>{{ dashboardStats.recoveryRate }}%</h3>
                    <p>Taux de Recouvrement</p>
                    <div class="stat-trend" [class.trend-up]="getRecoveryTrend() >= 0"
                      [class.trend-down]="getRecoveryTrend() < 0">
                      <i class='bx' [class.bx-up-arrow-alt]="getRecoveryTrend() >= 0"
                        [class.bx-down-arrow-alt]="getRecoveryTrend() < 0">
                      </i>
                      {{ getRecoveryTrend() >= 0 ? '+' : '' }}{{ getRecoveryTrend() }}% ce mois
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- FOOTER -->
        <footer class="content-footer">
          <div class="footer-text">
            ¬© 2026 Logistik - Version 1.0.0
            <span style="margin: 0 8px;">‚Ä¢</span>
            <a href="#" style="color: #696cff; text-decoration: none;" onclick="loadContent('aide')">Aide & Support</a>
            <span style="margin: 0 8px;">‚Ä¢</span>
            <a href="#" style="color: #696cff; text-decoration: none;" onclick="loadContent('apropos')">√Ä propos</a>
            <span style="margin: 0 8px;">‚Ä¢</span>
          </div>
        </footer>
      </div>
    </div>
  </div>
